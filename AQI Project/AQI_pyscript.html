<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AQI Monitor Pro</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .aqi-card {
            background-color: #ffffff;
            border-radius: 1.5rem; /* Rounded corners */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 250px; /* Ensure cards have a minimum height */
        }
        .aqi-value {
            font-size: 4.5rem; /* Larger font for AQI value */
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            transition: color 0.3s ease-in-out;
        }
        .aqi-status {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600;
            margin-bottom: 1rem;
            transition: color 0.3s ease-in-out;
        }
        .aqi-message {
            font-size: 1rem; /* text-base */
            color: #4a5568; /* gray-700 */
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* AQI Color Scales */
        .aqi-good { background-color: #2ECC71; color: #ffffff; } /* Green */
        .aqi-moderate { background-color: #F4D03F; color: #333333; } /* Yellow */
        .aqi-unhealthy-for-sensitive { background-color: #F39C12; color: #ffffff; } /* Orange */
        .aqi-unhealthy { background-color: #E74C3C; color: #ffffff; } /* Red */
        .aqi-very-unhealthy { background-color: #9B59B6; color: #ffffff; } /* Purple */
        .aqi-hazardous { background-color: #7F8C8D; color: #ffffff; } /* Gray/Dark */

        .aqi-good .aqi-value, .aqi-good .aqi-status { color: #ffffff; }
        .aqi-moderate .aqi-value, .aqi-moderate .aqi-status { color: #333333; }
        .aqi-unhealthy-for-sensitive .aqi-value, .aqi-unhealthy-for-sensitive .aqi-status { color: #ffffff; }
        .aqi-unhealthy .aqi-value, .aqi-unhealthy .aqi-status { color: #ffffff; }
        .aqi-very-unhealthy .aqi-value, .aqi-very-unhealthy .aqi-status { color: #ffffff; }
        .aqi-hazardous .aqi-value, .aqi-hazardous .aqi-status { color: #ffffff; }

        /* General button styling */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Fully rounded */
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-image: linear-gradient(to right, #6EE7B7, #34D399); /* Green gradient */
            color: #ffffff;
            border: none;
        }

        .btn-primary:hover {
            background-image: linear-gradient(to right, #34D399, #10B981);
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Modal styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            width: 80%;
            max-width: 500px;
            text-align: center;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center py-12 px-4">

    <div class="max-w-4xl w-full mx-auto p-8 bg-white rounded-3xl shadow-lg">
        <h1 class="text-5xl font-extrabold text-center text-gray-900 mb-8 tracking-tight">
            AQI Monitor Pro
        </h1>
        <p class="text-center text-lg text-gray-600 mb-10">
            Real-time Air Quality Index for your chosen location.
        </p>

        <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-8">
            <input
                type="text"
                id="locationInput"
                placeholder="Enter city, e.g., Delhi"
                class="flex-grow p-4 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-emerald-400 text-lg w-full md:w-auto"
            />
            <button
                id="getAqiBtn"
                class="btn btn-primary text-lg w-full md:w-auto"
            >
                Get AQI
            </button>
        </div>

        <div id="aqiResult" class="hidden flex justify-center items-center">
            <div id="loadingSpinner" class="loading-spinner hidden"></div>
            <div id="aqiCard" class="aqi-card hidden w-full max-w-sm">
                <p class="text-gray-600 text-lg mb-2">AQI for <span id="locationName" class="font-semibold"></span></p>
                <p id="aqiValue" class="aqi-value"></p>
                <p id="aqiStatus" class="aqi-status"></p>
                <p id="aqiMessage" class="aqi-message"></p>
                <p id="dominantPollutant" class="aqi-message mt-2"></p>
            </div>
        </div>

        <div class="mt-12 p-6 bg-gray-50 rounded-2xl border border-gray-200">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">Air Quality Prediction (Conceptual)</h2>
            <p class="text-gray-700 text-center leading-relaxed">
                A true AQI *prediction* system would involve sophisticated machine learning models.
                These models analyze historical air quality data, weather patterns, traffic, and other
                environmental factors to forecast future AQI levels. This frontend demonstrates
                real-time monitoring. For a full prediction system, a robust backend infrastructure
                with data processing and ML capabilities would be required.
            </p>
        </div>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalMessage" class="text-xl text-gray-800"></p>
        </div>
    </div>

    <script>
        // Global variables for Firebase configuration, if persistence were to be added.
        // For this client-side only example, they are not strictly needed,
        // but included for completeness as per instructions.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const locationInput = document.getElementById('locationInput');
        const getAqiBtn = document.getElementById('getAqiBtn');
        const aqiResult = document.getElementById('aqiResult');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const aqiCard = document.getElementById('aqiCard');
        const locationNameSpan = document.getElementById('locationName');
        const aqiValueSpan = document.getElementById('aqiValue');
        const aqiStatusSpan = document.getElementById('aqiStatus');
        const aqiMessageSpan = document.getElementById('aqiMessage');
        const dominantPollutantSpan = document.getElementById('dominantPollutant');

        // Modal elements
        const modal = document.getElementById("myModal");
        const modalMessage = document.getElementById("modalMessage");
        const closeButton = document.getElementsByClassName("close-button")[0];

        // Function to show custom modal messages instead of alert()
        function showModal(message) {
            modalMessage.textContent = message;
            modal.style.display = "flex"; // Use flex to center
        }

        // When the user clicks on <span> (x), close the modal
        closeButton.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Function to get AQI data
        async function getAirQualityData(city) {
            aqiResult.classList.remove('hidden');
            loadingSpinner.classList.remove('hidden');
            aqiCard.classList.add('hidden');

            try {
                // Using OpenWeatherMap Air Pollution API (requires an API key)
                // You would typically get an API key from OpenWeatherMap for this.
                // For demonstration, leaving API key empty will cause the fetch to fail
                // in a real environment unless the environment provides it.
                // Replace with your actual OpenWeatherMap API key if testing independently.
                const apiKey = ""; // Canvas will provide this in runtime if needed for actual LLM/image generation.
                                   // For a simple external API like OpenWeatherMap, you'd need to register
                                   // and get your own key.

                // First, get coordinates for the city using OpenWeatherMap's Geocoding API
                const geoUrl = `https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${apiKey}`;
                const geoResponse = await fetch(geoUrl);
                if (!geoResponse.ok) {
                    throw new Error(`HTTP error! status: ${geoResponse.status}`);
                }
                const geoData = await geoResponse.json();

                if (!geoData || geoData.length === 0) {
                    showModal("City not found. Please try again.");
                    return;
                }

                const { lat, lon, name, country } = geoData[0];
                locationNameSpan.textContent = `${name}, ${country}`;

                // Then, get AQI data using the coordinates
                const aqiUrl = `https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`;
                const aqiResponse = await fetch(aqiUrl);
                if (!aqiResponse.ok) {
                    throw new Error(`HTTP error! status: ${aqiResponse.status}`);
                }
                const aqiData = await aqiResponse.json();

                if (!aqiData || !aqiData.list || aqiData.list.length === 0) {
                    showModal("No AQI data available for this location.");
                    return;
                }

                const currentAqi = aqiData.list[0].main.aqi; // AQI value from 1 to 5
                const components = aqiData.list[0].components;

                let aqiDisplayValue; // This will be the value displayed to the user
                let statusText = "Unknown";
                let statusClass = "";
                let message = "";
                let dominantPollutant = "";

                // Determine dominant pollutant (simple approach for display)
                const pollutants = {
                    'co': components.co,
                    'no': components.no,
                    'no2': components.no2,
                    'o3': components.o3,
                    'so2': components.so2,
                    'pm2_5': components.pm2_5,
                    'pm10': components.pm10,
                    'nh3': components.nh3
                };

                // Find the pollutant with the highest concentration (relative to common concerns)
                // This is a simplified dominant pollutant detection. A real system would use more complex rules.
                let maxConcentration = -1;
                for (const key in pollutants) {
                    if (pollutants[key] > maxConcentration) {
                        maxConcentration = pollutants[key];
                        dominantPollutant = key.toUpperCase().replace('_', '.'); // Format like PM2.5
                    }
                }
                if (dominantPollutant) {
                    dominantPollutantSpan.textContent = `Dominant Pollutant: ${dominantPollutant} (${maxConcentration.toFixed(2)} µg/m³ or ppm)`;
                } else {
                     dominantPollutantSpan.textContent = '';
                }


                // OpenWeatherMap AQI is 1-5. Map to a more familiar 0-500 scale and categories.
                // This is a rough mapping for illustrative purposes. Real AQI calculations are more complex.
                switch (currentAqi) {
                    case 1:
                        aqiDisplayValue = Math.floor(Math.random() * (50 - 0 + 1)) + 0; // 0-50
                        statusText = "Good";
                        statusClass = "aqi-good";
                        message = "Air quality is considered satisfactory, and air pollution poses little or no risk.";
                        break;
                    case 2:
                        aqiDisplayValue = Math.floor(Math.random() * (100 - 51 + 1)) + 51; // 51-100
                        statusText = "Moderate";
                        statusClass = "aqi-moderate";
                        message = "Air quality is acceptable; however, there may be a moderate health concern for a very small number of people.";
                        break;
                    case 3:
                        aqiDisplayValue = Math.floor(Math.random() * (150 - 101 + 1)) + 101; // 101-150
                        statusText = "Unhealthy for Sensitive Groups";
                        statusClass = "aqi-unhealthy-for-sensitive";
                        message = "Members of sensitive groups may experience health effects. The general public is less likely to be affected.";
                        break;
                    case 4:
                        aqiDisplayValue = Math.floor(Math.random() * (200 - 151 + 1)) + 151; // 151-200
                        statusText = "Unhealthy";
                        statusClass = "aqi-unhealthy";
                        message = "Everyone may begin to experience health effects; members of sensitive groups may experience more serious health effects.";
                        break;
                    case 5:
                        aqiDisplayValue = Math.floor(Math.random() * (300 - 201 + 1)) + 201; // 201-300+
                        statusText = "Very Unhealthy"; // Or Hazardous if > 300, simplified here
                        statusClass = "aqi-very-unhealthy";
                        message = "Health warnings of emergency conditions. The entire population is more likely to be affected.";
                        if (aqiDisplayValue > 300) {
                            aqiDisplayValue = Math.floor(Math.random() * (500 - 301 + 1)) + 301;
                            statusText = "Hazardous";
                            statusClass = "aqi-hazardous";
                            message = "Health alert: everyone may experience more serious health effects.";
                        }
                        break;
                    default:
                        aqiDisplayValue = "N/A";
                        statusText = "Data Unavailable";
                        statusClass = "";
                        message = "Could not retrieve AQI data for this location.";
                        break;
                }

                aqiValueSpan.textContent = aqiDisplayValue;
                aqiStatusSpan.textContent = statusText;
                aqiMessageSpan.textContent = message;

                // Remove previous status classes and add new one
                aqiCard.classList.remove('aqi-good', 'aqi-moderate', 'aqi-unhealthy-for-sensitive', 'aqi-unhealthy', 'aqi-very-unhealthy', 'aqi-hazardous');
                if (statusClass) {
                    aqiCard.classList.add(statusClass);
                }

                aqiCard.classList.remove('hidden');

            } catch (error) {
                console.error("Error fetching AQI data:", error);
                showModal("Failed to fetch AQI data. Please check the city name and your API key (if needed).");
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        // Event listener for the button
        getAqiBtn.addEventListener('click', () => {
            const city = locationInput.value.trim();
            if (city) {
                getAirQualityData(city);
            } else {
                showModal("Please enter a city name.");
            }
        });

        // Optional: Trigger AQI fetch on Enter key press in the input field
        locationInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                getAqiBtn.click();
            }
        });

        // Initialize with a default city on load, e.g., Delhi
        window.onload = function() {
            // For production, consider using a user's geolocation or a prominent city.
            // For this example, let's keep it simple.
            // getAirQualityData("Delhi"); // Uncomment to load Delhi by default
        };
    </script>
</body>
</html>
