import React, { useState, useEffect } from 'react';
// Removed 'Drone' from lucide-react import as it's not directly available.
import { MapPin, TrendingUp, Activity, Calendar, Smartphone, Radio, AlertCircle, Info } from 'lucide-react';

// Mock data for different states
const stateData = {
  'Delhi': {
    currentAQI: 189,
    forecast: [189, 195, 201, 178, 162, 145, 156, 171, 183, 167, 152],
    coordinates: '28.7041, 77.1025',
    stations: 37
  },
  'Andhra Pradesh': {
    currentAQI: 112,
    forecast: [112, 118, 125, 108, 102, 95, 101, 114, 119, 106, 99],
    coordinates: '15.9129, 79.7400',
    stations: 18
  },
  'Arunachal Pradesh': {
    currentAQI: 45,
    forecast: [45, 48, 52, 41, 38, 35, 39, 46, 49, 43, 40],
    coordinates: '28.2180, 94.7278',
    stations: 8
  },
  'Assam': {
    currentAQI: 78,
    forecast: [78, 82, 87, 74, 71, 66, 72, 80, 85, 77, 73],
    coordinates: '26.2006, 92.9376',
    stations: 15
  },
  'Bihar': {
    currentAQI: 167,
    forecast: [167, 173, 180, 159, 152, 145, 153, 165, 172, 161, 154],
    coordinates: '25.0961, 85.3131',
    stations: 21
  },
  'Chhattisgarh': {
    currentAQI: 134,
    forecast: [134, 140, 147, 128, 122, 115, 123, 136, 142, 131, 125],
    coordinates: '21.2787, 81.8661',
    stations: 16
  },
  'Goa': {
    currentAQI: 58,
    forecast: [58, 62, 67, 54, 51, 47, 53, 60, 64, 57, 52],
    coordinates: '15.2993, 74.1240',
    stations: 6
  },
  'Gujarat': {
    currentAQI: 145,
    forecast: [145, 152, 158, 139, 132, 125, 131, 146, 151, 144, 137],
    coordinates: '23.0225, 72.5714',
    stations: 24
  },
  'Haryana': {
    currentAQI: 178,
    forecast: [178, 184, 191, 169, 162, 155, 163, 176, 182, 170, 164],
    coordinates: '29.0588, 76.0856',
    stations: 19
  },
  'Himachal Pradesh': {
    currentAQI: 52,
    forecast: [52, 56, 61, 48, 45, 41, 47, 54, 58, 51, 46],
    coordinates: '31.1048, 77.1734',
    stations: 12
  },
  'Jharkhand': {
    currentAQI: 156,
    forecast: [156, 162, 169, 148, 141, 134, 142, 154, 160, 149, 143],
    coordinates: '23.6102, 85.2799',
    stations: 17
  },
  'Karnataka': {
    currentAQI: 98,
    forecast: [98, 105, 112, 89, 94, 87, 91, 103, 108, 95, 88],
    coordinates: '15.3173, 75.7139',
    stations: 22
  },
  'Kerala': {
    currentAQI: 64,
    forecast: [64, 68, 73, 59, 56, 52, 58, 66, 70, 63, 57],
    coordinates: '10.8505, 76.2711',
    stations: 14
  },
  'Madhya Pradesh': {
    currentAQI: 142,
    forecast: [142, 148, 155, 135, 128, 121, 129, 141, 147, 136, 130],
    coordinates: '22.9734, 78.6569',
    stations: 26
  },
  'Maharashtra': {
    currentAQI: 127,
    forecast: [127, 134, 142, 125, 119, 108, 115, 129, 135, 128, 121],
    coordinates: '19.7515, 75.7139',
    stations: 28
  },
  'Manipur': {
    currentAQI: 67,
    forecast: [67, 71, 76, 62, 59, 55, 61, 69, 73, 66, 60],
    coordinates: '24.6637, 93.9063',
    stations: 7
  },
  'Meghalaya': {
    currentAQI: 49,
    forecast: [49, 53, 58, 45, 42, 38, 44, 51, 55, 48, 43],
    coordinates: '25.4670, 91.3662',
    stations: 9
  },
  'Mizoram': {
    currentAQI: 41,
    forecast: [41, 45, 50, 37, 34, 31, 37, 43, 47, 40, 36],
    coordinates: '23.1645, 92.9376',
    stations: 5
  },
  'Nagaland': {
    currentAQI: 56,
    forecast: [56, 60, 65, 51, 48, 44, 50, 58, 62, 55, 49],
    coordinates: '26.1584, 94.5624',
    stations: 8
  },
  'Odisha': {
    currentAQI: 119,
    forecast: [119, 125, 132, 113, 107, 100, 108, 121, 127, 116, 110],
    coordinates: '20.9517, 85.0985',
    stations: 20
  },
  'Punjab': {
    currentAQI: 172,
    forecast: [172, 178, 185, 164, 157, 150, 158, 170, 176, 165, 159],
    coordinates: '31.1471, 75.3412',
    stations: 23
  },
  'Rajasthan': {
    currentAQI: 158,
    forecast: [158, 164, 171, 150, 143, 136, 144, 156, 162, 151, 145],
    coordinates: '27.0238, 74.2179',
    stations: 25
  },
  'Sikkim': {
    currentAQI: 38,
    forecast: [38, 42, 47, 34, 31, 28, 34, 40, 44, 37, 33],
    coordinates: '27.5330, 88.5122',
    stations: 4
  },
  'Tamil Nadu': {
    currentAQI: 76,
    forecast: [76, 82, 89, 71, 68, 63, 69, 78, 84, 77, 72],
    coordinates: '11.1271, 78.6569',
    stations: 19
  },
  'Telangana': {
    currentAQI: 124,
    forecast: [124, 130, 137, 118, 112, 105, 113, 126, 132, 121, 115],
    coordinates: '18.1124, 79.0193',
    stations: 16
  },
  'Tripura': {
    currentAQI: 73,
    forecast: [73, 77, 82, 68, 65, 61, 67, 75, 79, 72, 66],
    coordinates: '23.9408, 91.9882',
    stations: 6
  },
  'Uttar Pradesh': {
    currentAQI: 201,
    forecast: [201, 208, 215, 192, 185, 178, 187, 199, 206, 194, 181],
    coordinates: '26.8467, 80.9462',
    stations: 31
  },
  'Uttarakhand': {
    currentAQI: 89,
    forecast: [89, 93, 98, 84, 81, 76, 82, 91, 95, 88, 83],
    coordinates: '30.0668, 79.0193',
    stations: 13
  },
  'West Bengal': {
    currentAQI: 148,
    forecast: [148, 154, 161, 141, 134, 127, 135, 147, 153, 142, 136],
    coordinates: '22.9868, 87.8550',
    stations: 27
  },
  // Union Territories
  'Andaman and Nicobar Islands': {
    currentAQI: 32,
    forecast: [32, 36, 41, 28, 25, 22, 28, 34, 38, 31, 27],
    coordinates: '11.7401, 92.6586',
    stations: 3
  },
  'Chandigarh': {
    currentAQI: 165,
    forecast: [165, 171, 178, 157, 150, 143, 151, 163, 169, 158, 152],
    coordinates: '30.7333, 76.7794',
    stations: 8
  },
  'Dadra and Nagar Haveli and Daman and Diu': {
    currentAQI: 92,
    forecast: [92, 96, 101, 87, 84, 79, 85, 94, 98, 91, 86],
    coordinates: '20.1809, 73.0169',
    stations: 5
  },
  'Jammu and Kashmir': {
    currentAQI: 71,
    forecast: [71, 75, 80, 66, 63, 58, 64, 73, 77, 70, 65],
    coordinates: '34.0837, 74.7973',
    stations: 11
  },
  'Ladakh': {
    currentAQI: 28,
    forecast: [28, 32, 37, 24, 21, 18, 24, 30, 34, 27, 23],
    coordinates: '34.1526, 77.5771',
    stations: 4
  },
  'Lakshadweep': {
    currentAQI: 25,
    forecast: [25, 29, 34, 21, 18, 15, 21, 27, 31, 24, 20],
    coordinates: '10.5667, 72.6417',
    stations: 2
  },
  'Puducherry': {
    currentAQI: 81,
    forecast: [81, 85, 90, 76, 73, 68, 74, 83, 87, 80, 75],
    coordinates: '11.9416, 79.8083',
    stations: 4
  }
};

// Helper function to determine AQI status, color, and background based on AQI value
const getAQIStatus = (aqi: number) => {
  if (aqi <= 50) return { label: 'Good', color: 'text-green-600', bg: 'bg-green-100', border: 'border-green-300' };
  if (aqi <= 100) return { label: 'Moderate', color: 'text-yellow-600', bg: 'bg-yellow-100', border: 'border-yellow-300' };
  if (aqi <= 150) return { label: 'Unhealthy for Sensitive Groups', color: 'text-orange-600', bg: 'bg-orange-100', border: 'border-orange-300' };
  if (aqi <= 200) return { label: 'Unhealthy', color: 'text-red-600', bg: 'bg-red-100', border: 'border-red-300' };
  if (aqi <= 300) return { label: 'Very Unhealthy', color: 'text-purple-600', bg: 'bg-purple-100', border: 'border-purple-300' };
  return { label: 'Hazardous', color: 'text-red-800', bg: 'bg-red-200', border: 'border-red-400' };
};

// Helper function to get the full background color for the progress bar
const getAQIColor = (aqi: number) => {
  if (aqi <= 50) return 'bg-green-500';
  if (aqi <= 100) return 'bg-yellow-500';
  if (aqi <= 150) return 'bg-orange-500';
  if (aqi <= 200) return 'bg-red-500';
  if (aqi <= 300) return 'bg-purple-500';
  return 'bg-red-700';
};

// ForecastChart component to display a simple line graph of AQI forecast
const ForecastChart = ({ forecast, currentAQI }: { forecast: number[], currentAQI: number }) => {
  // Calculate max and min AQI for scaling the chart
  const maxAQI = Math.max(...forecast);
  const minAQI = Math.min(...forecast);
  // Ensure range is not zero to prevent division by zero for flat forecasts
  const range = maxAQI === minAQI ? 100 : maxAQI - minAQI; // Use a default range if all values are same

  return (
    <div className="mt-6">
      <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
        <TrendingUp className="h-5 w-5 text-blue-600" />
        10-Day AQI Forecast
      </h3>
      <div className="relative h-64 bg-gray-50 rounded-lg p-4 overflow-x-auto">
        {/* SVG for the chart. min-w-[600px] ensures it doesn't shrink too much on small screens */}
        <svg className="w-full h-full min-w-[600px]" viewBox="0 0 600 200">
          {/* Horizontal Grid lines */}
          {[0, 1, 2, 3, 4].map(i => (
            <line
              key={i}
              x1="0"
              y1={i * 40}
              x2="600"
              y2={i * 40}
              stroke="#e5e7eb"
              strokeWidth="1"
            />
          ))}
          
          {/* AQI line graph */}
          <polyline
            fill="none"
            stroke="#3b82f6" /* Blue color for the line */
            strokeWidth="3"
            strokeLinecap="round"
            strokeLinejoin="round"
            points={forecast.map((aqi, index) => {
              // Calculate X position: evenly spaced points across the width
              const x = (index / (forecast.length - 1)) * 580 + 10; // 580px width for chart, 10px padding
              // Calculate Y position: scale AQI to fit the 200px height (0-180 for padding)
              const y = 180 - ((aqi - minAQI) / range) * 160; // 180px offset from top (bottom of graph), 160px height for values
              return `${x},${y}`;
            }).join(' ')}
          />
          
          {/* Data points (circles and text labels) */}
          {forecast.map((aqi, index) => {
            const x = (index / (forecast.length - 1)) * 580 + 10;
            const y = 180 - ((aqi - minAQI) / range) * 160;
            return (
              <g key={index}>
                <circle
                  cx={x}
                  cy={y}
                  r="4"
                  fill="#3b82f6" /* Blue color for circles */
                  className="hover:r-6 transition-all" // Hover effect for circles
                />
                <text
                  x={x}
                  y={y - 10} /* Position text slightly above the circle */
                  textAnchor="middle" /* Center text horizontally */
                  fontSize="12"
                  fill="#4b5563" /* Dark gray text color */
                >
                  {aqi}
                </text>
              </g>
            );
          })}
        </svg>
        
        {/* X-axis labels for days */}
        <div className="flex justify-between mt-2 text-xs text-gray-500 min-w-[600px]">
          {['Today', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10'].map(day => (
            <span key={day} className="flex-1 text-center">{day}</span> // Use flex-1 for even spacing
          ))}
        </div>
      </div>
    </div>
  );
};

// Simulated Drone Output Component
const DroneSimulationOutput = () => {
  const [outputLines, setOutputLines] = useState<any[]>([]);
  const [isSimulating, setIsSimulating] = useState(false);

  // Sample data to simulate Python script output with added locations
  const simulatedPythonOutput = [
    { text: "--- Drone AQI Monitoring Simulation Across India ---", className: "text-blue-500 font-bold" },
    { text: "Starting at Lat: 23.0000, Lon: 79.0000", className: "text-gray-700" },
    { text: "Hotspot Locations (Influence Radius: 0.0100 degrees, approx 1.11 km):", className: "text-gray-700" },
    { text: " - Delhi (National Capital Region): Lat=28.6100, Lon=77.2000, Impact Factor: 1.8x", className: "text-gray-600" },
    { text: " - Mumbai (Maharashtra): Lat=19.0700, Lon=72.8700, Impact Factor: 1.9x", className: "text-gray-600" },
    { text: " - Bengaluru (Karnataka): Lat=12.9700, Lon=77.5900, Impact Factor: 1.85x", className: "text-gray-600" },
    { text: "--- Initiating Drone Flight Across India ---", className: "text-blue-500 font-bold mt-4" },
    { text: "Step: 0", className: "text-gray-700 mt-2" },
    { text: "Location: Bhopal, Madhya Pradesh (Lat=23.2500, Lon=77.4100)", className: "text-gray-700" },
    { text: "Target Waypoint 1: Lat=28.7041, Lon=77.1025", className: "text-gray-700" },
    { text: "  AQI: 189 (Unhealthy)", className: "text-yellow-600 font-bold" },
    { text: "  PM2.5: 105.34 µg/m³", className: "text-gray-600" },
    { text: "  PM10: 210.68 µg/m³", className: "text-gray-600" },
    { text: "  CO: 7.21 mg/m³", className: "text-gray-600" },
    { text: "  NO2: 120.55 µg/m³", className: "text-gray-600" },
    { text: "  SO2: 70.33 µg/m³", className: "text-gray-600" },
    { text: "--- Arrived at Waypoint 1 ---", className: "text-green-600 font-bold mt-2" },
    { text: "Moving to next waypoint: Lat=15.9129, Lon=79.7400", className: "text-gray-700" },
    { text: "Step: 1", className: "text-gray-700 mt-2" },
    { text: "Location: Hyderabad, Telangana (Lat=17.3800, Lon=78.4800)", className: "text-gray-700" },
    { text: "Target Waypoint 2: Lat=15.9129, Lon=79.7400", className: "text-gray-700" },
    { text: "  AQI: 112 (Satisfactory)", className: "text-cyan-600 font-bold" },
    { text: "  PM2.5: 55.78 µg/m³", className: "text-gray-600" },
    { text: "  PM10: 102.12 µg/m³", className: "text-gray-600" },
    { text: "  CO: 3.50 mg/m³", className: "text-gray-600" },
    { text: "  NO2: 60.10 µg/m³", className: "text-gray-600" },
    { text: "  SO2: 30.20 µg/m³", className: "text-gray-600" },
    { text: "--- Arrived at Waypoint 2 ---", className: "text-green-600 font-bold mt-2" },
    { text: "Moving to next waypoint: Lat=28.2180, Lon=94.7278", className: "text-gray-700" },
    { text: "Step: 2", className: "text-gray-700 mt-2" },
    { text: "Location: Guwahati, Assam (Lat=26.1800, Lon=91.7300)", className: "text-gray-700" },
    { text: "Target Waypoint 3: Lat=28.2180, Lon=94.7278", className: "text-gray-700" },
    { text: "  AQI: 45 (Good)", className: "text-green-600 font-bold" },
    { text: "  PM2.5: 22.50 µg/m³", className: "text-gray-600" },
    { text: "  PM10: 45.00 µg/m³", className: "text-gray-600" },
    { text: "  CO: 1.20 mg/m³", className: "text-gray-600" },
    { text: "  NO2: 25.00 µg/m³", className: "text-gray-600" },
    { text: "  SO2: 15.00 µg/m³", className: "text-gray-600" },
    { text: "--- Arrived at Waypoint 3 ---", className: "text-green-600 font-bold mt-2" },
    { text: "Moving to next waypoint: Lat=26.2006, Lon=92.9376", className: "text-gray-700" },
    { text: "--- All waypoints visited. Simulation complete. ---", className: "text-blue-500 font-bold mt-4" },
    { text: "\n==============================", className: "text-gray-800 font-bold" },
    { text: "      AQI Report Summary", className: "text-gray-800 font-bold" },
    { text: "==============================", className: "text-gray-800 font-bold" },
    { text: "Best Air Quality Observed:", className: "text-green-600 font-bold mt-4" },
    { text: "  Location: Guwahati, Assam (Lat=18.0000, Lon=82.0000)", className: "text-gray-700" },
    { text: "  AQI: 45 (Good)", className: "text-green-600 font-bold" },
    { text: "  Coordinates: Lat=18.0000, Lon=82.0000", className: "text-gray-700" },
    { text: "Worst Air Quality Observed:", className: "text-red-600 font-bold mt-4" },
    { text: "  Location: Bhopal, Madhya Pradesh (Lat=23.0000, Lon=79.0000)", className: "text-gray-700" },
    { text: "  AQI: 189 (Unhealthy)", className: "text-red-600 font-bold" },
    { text: "  Coordinates: Lat=23.0000, Lon=79.0000", className: "text-gray-700" },
    { text: "------------------------------", className: "text-gray-800 font-bold mt-4" },
    { text: "Good/Bad City Report", className: "text-gray-800 font-bold" },
    { text: "------------------------------", className: "text-gray-800 font-bold" },
    { text: "  Good city (lowest AQI): Guwahati, Assam | AQI 45 (Good)", className: "text-gray-700" },
    { text: "  Bad city (highest AQI): Bhopal, Madhya Pradesh | AQI 189 (Unhealthy)", className: "text-gray-700" },
    { text: "==============================", className: "text-gray-800 font-bold" },
  ];

  const runSimulation = () => {
    setIsSimulating(true);
    setOutputLines([]); // Clear previous output
    let i = 0;
    const interval = setInterval(() => {
      if (i < simulatedPythonOutput.length) {
        setOutputLines(prev => [...prev, simulatedPythonOutput[i]]);
        i++;
      } else {
        clearInterval(interval);
        setIsSimulating(false);
      }
    }, 100); // Adjust speed of output here (milliseconds per line)
  };

  return (
    <div className="bg-gray-900 text-gray-100 rounded-xl shadow-lg p-6 font-mono text-sm h-full flex flex-col">
      <h3 className="text-lg font-semibold mb-4 flex items-center gap-2 text-white">
        {/* Replaced <Drone /> with inline SVG */}
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5 text-indigo-400">
          <path d="M10 10l-6 6V4a2 2 0 0 1 2-2h8.5L20 7.5V14l-6-6h-4zM10 10l4 4m0 0l6-6v8.5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8.5z" />
        </svg>
        Drone Simulation Output
      </h3>
      <div className="flex-grow overflow-y-auto bg-gray-800 p-3 rounded-lg border border-gray-700 custom-scrollbar">
        {/* Added defensive check to ensure 'line' is not null/undefined */}
        {outputLines.map((line, index) => (
          line && typeof line.text === 'string' ? (
            <p key={index} className={`${line.className || ''}`}>{line.text}</p>
          ) : null
        ))}
        {outputLines.length === 0 && !isSimulating && (
          <p className="text-gray-500">Click "Run Simulation" to see drone activity...</p>
        )}
      </div>
      <button
        onClick={runSimulation}
        disabled={isSimulating}
        className={`mt-4 w-full py-3 rounded-full font-bold transition-all duration-300
          ${isSimulating ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : 'bg-indigo-500 hover:bg-indigo-600 text-white shadow-md hover:shadow-lg'}
        `}
      >
        {isSimulating ? 'Running Simulation...' : 'Run Simulation'}
      </button>
      <style>{`
        /* Custom Scrollbar for the output div */
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #374151; /* gray-700 */
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #6b7280; /* gray-500 */
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #9ca3af; /* gray-400 */
        }
      `}</style>
    </div>
  );
};


// Main App component
function App() {
  const [selectedState, setSelectedState] = useState('Delhi'); // State to hold the currently selected Indian state
  const [currentTime, setCurrentTime] = useState(new Date()); // State to hold and update the current time

  // useEffect hook to update the current time every second
  useEffect(() => {
    const timer = setInterval(() => setCurrentTime(new Date()), 1000);
    // Cleanup function to clear the interval when the component unmounts
    return () => clearInterval(timer);
  }, []); // Empty dependency array means this effect runs once on mount and cleans up on unmount

  // Get the data for the currently selected state
  const currentData = stateData[selectedState as keyof typeof stateData];
  // Get the AQI status (Good, Moderate, etc.) and associated colors/classes
  const aqiStatus = getAQIStatus(currentData.currentAQI);

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50">
      {/* Header section */}
      <header className="bg-white/80 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div className="flex items-center justify-between">
            {/* Logo and App Title */}
            <div className="flex items-center gap-3">
              <Activity className="h-8 w-8 text-blue-600" /> {/* Lucide React icon */}
              <div>
                <h1 className="text-2xl font-bold text-gray-900">AQI Monitor Pro</h1>
                <p className="text-sm text-gray-600">Technological AQI Prediction System</p>
              </div>
            </div>
            {/* Current Date and Time */}
            <div className="text-right text-sm text-gray-600">
              <p>{currentTime.toLocaleDateString()}</p>
              <p>{currentTime.toLocaleTimeString()}</p>
            </div>
          </div>
        </div>
      </header>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* State Selection Dropdown */}
        <div className="mb-8 p-4 bg-white rounded-xl shadow-md">
          <label htmlFor="state-select" className="block text-sm font-medium text-gray-700 mb-3">
            Select State for AQI Monitoring:
          </label>
          <select
            id="state-select"
            value={selectedState}
            onChange={(e) => setSelectedState(e.target.value)}
            className="w-full sm:w-96 px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-lg"
          >
            {/* Map through the keys of stateData to create options */}
            {Object.keys(stateData).map(state => (
              <option key={state} value={state}>{state}</option>
            ))}
          </select>
        </div>

        {/* Main Content Grid: AQI Display + Drone Simulation */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Main AQI Display Card (takes 2/3 width on large screens) */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
              <div className="flex items-center justify-between mb-6">
                {/* Location Information */}
                <div className="flex items-center gap-3">
                  <MapPin className="h-6 w-6 text-gray-600" /> {/* Lucide React icon */}
                  <div>
                    <h2 className="text-xl font-semibold text-gray-900">{selectedState}</h2>
                    <p className="text-sm text-gray-500">{currentData.coordinates}</p>
                  </div>
                </div>
                {/* Current AQI Status Badge */}
                <span className={`px-3 py-1 rounded-full text-sm font-medium ${aqiStatus.bg} ${aqiStatus.color} ${aqiStatus.border} border`}>
                  {aqiStatus.label}
                </span>
              </div>

              {/* Current AQI Value and Progress Bar */}
              <div className="text-center mb-6">
                <div className="text-6xl font-bold text-gray-900 mb-2">
                  {currentData.currentAQI}
                </div>
                <p className="text-gray-600">Current Air Quality Index</p>
                <div className="mt-4 w-full bg-gray-200 rounded-full h-3">
                  {/* AQI Progress Bar */}
                  <div
                    className={`h-3 rounded-full transition-all duration-1000 ${getAQIColor(currentData.currentAQI)}`}
                    // Width is calculated as a percentage of 300 (max AQI for progress bar visual)
                    style={{ width: `${Math.min((currentData.currentAQI / 300) * 100, 100)}%` }}
                  />
                </div>
              </div>

              {/* Forecast Chart Component */}
              <ForecastChart forecast={currentData.forecast} currentAQI={currentData.currentAQI} />
            </div>
          </div>

          {/* Drone Simulation Output Sidebar (takes 1/3 width on large screens) */}
          <div className="lg:col-span-1">
            <DroneSimulationOutput />
          </div>
        </div>

        {/* Sidebar (Existing content moved here) */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-8"> {/* Adjusted grid for smaller screens */}
          {/* Monitoring Stations */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <Radio className="h-5 w-5 text-green-600" /> {/* Lucide React icon */}
              Monitoring Network
            </h3>
            <div className="space-y-4">
              <div className="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                <div className="flex items-center gap-2">
                  <Smartphone className="h-4 w-4 text-blue-600" /> {/* Lucide React icon */}
                  <span className="text-sm font-medium">Mobile Stations</span>
                </div>
                {/* Display calculated number of mobile stations */}
                <span className="text-blue-600 font-semibold">{Math.floor(currentData.stations * 0.6)}</span>
              </div>
              <div className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                <div className="flex items-center gap-2">
                  <Radio className="h-4 w-4 text-green-600" /> {/* Lucide React icon */}
                  <span className="text-sm font-medium">Fixed Stations</span>
                </div>
                {/* Display calculated number of fixed stations */}
                <span className="text-green-600 font-semibold">{Math.floor(currentData.stations * 0.4)}</span>
              </div>
              <div className="text-center pt-2 border-t border-gray-200"> {/* Added border-gray-200 */}
                <span className="text-lg font-bold text-gray-900">{currentData.stations}</span>
                <p className="text-sm text-gray-600">Total Active Stations</p>
              </div>
            </div>
          </div>

          {/* Health Recommendations Card */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <AlertCircle className="h-5 w-5 text-orange-600" /> {/* Lucide React icon */}
              Health Advisory
            </h3>
            {/* Health message based on current AQI status */}
            <div className={`p-4 rounded-lg ${aqiStatus.bg} border ${aqiStatus.border}`}>
              <p className={`font-medium ${aqiStatus.color}`}>{aqiStatus.label}</p>
              <p className="text-sm text-gray-700 mt-2">
                {currentData.currentAQI <= 50 && "Air quality is good. Ideal for outdoor activities."}
                {currentData.currentAQI > 50 && currentData.currentAQI <= 100 && "Air quality is acceptable. Unusually sensitive people should consider limiting outdoor activities."}
                {currentData.currentAQI > 100 && currentData.currentAQI <= 150 && "Sensitive groups should reduce outdoor activities and limit prolonged outdoor exertion."}
                {currentData.currentAQI > 150 && currentData.currentAQI <= 200 && "Everyone may begin to experience health effects; sensitive groups should avoid outdoor activities."}
                {currentData.currentAQI > 200 && currentData.currentAQI <= 300 && "Health warnings of emergency conditions. The entire population is more likely to be affected. Avoid all outdoor physical activity."}
                {currentData.currentAQI > 300 && "Health alert: everyone may experience more serious health effects. Stay indoors and limit physical activity."}
              </p>
            </div>
          </div>

          {/* Technology Info Card */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <Info className="h-5 w-5 text-purple-600" /> {/* Lucide React icon */}
              Technology Stack
            </h3>
            <div className="space-y-3 text-sm text-gray-700">
              <div className="flex items-center gap-2">
                <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                <span>IoT-enabled mobile monitoring units</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                <span>Satellite data integration</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-2 h-2 bg-purple-500 rounded-full"></div>
                <span>Machine learning prediction models</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-2 h-2 bg-orange-500 rounded-full"></div>
                <span>Real-time data processing</span>
              </div>
            </div>
          </div>
        </div>

        {/* AQI Scale Reference */}
        <div className="mt-8 bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-lg font-semibold mb-6 flex items-center gap-2">
            <Calendar className="h-5 w-5 text-indigo-600" /> {/* Lucide React icon */}
            AQI Scale Reference
          </h3>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            {[
              { range: '0-50', label: 'Good', color: 'bg-green-500' },
              { range: '51-100', label: 'Moderate', color: 'bg-yellow-500' },
              { range: '101-150', label: 'Unhealthy for Sensitive', color: 'bg-orange-500' },
              { range: '151-200', label: 'Unhealthy', color: 'bg-red-500' },
              { range: '201-300', label: 'Very Unhealthy', color: 'bg-purple-500' },
              { range: '301+', label: 'Hazardous', color: 'bg-red-700' }
            ].map((item, index) => (
              <div key={index} className="text-center">
                <div className={`h-3 ${item.color} rounded-full mb-2`}></div>
                <p className="text-xs font-medium text-gray-900">{item.range}</p>
                <p className="text-xs text-gray-600">{item.label}</p>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Footer section */}
      <footer className="bg-gray-900 text-white py-8 mt-16">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <p className="mb-2">AQI Monitor Pro - Advanced Air Quality Prediction System</p>
          <p className="text-gray-400 text-sm">Hackathon Project: Technological Solutions for AQI Monitoring</p>
        </div>
      </footer>
    </div>
  );
}

// Changed the export to ensure it's correctly interpreted as the default export
const ExportedApp = App;
export default ExportedApp;
